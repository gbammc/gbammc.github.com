
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>django + pip + virtualenv ＋ postgres - Alvin Zhu</title>
	<meta name="author" content="Alvin Zhu">

	
	<meta name="description" content="最近兴趣所致，想学习利用 Django 编写一个项目，无奈之前不太懂 python，在机子乱搞一通后发现系统的环境都被玩坏了，GoAgentX 都跑不了..不过经过一番折腾后总算是走上正轨，所以顺便总结一下吧。">
	<meta name="keywords" content="python django pip virtualenv virtualenvwrapper postgres">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Alvin Zhu" type="application/atom+xml">
	
	<link rel="canonical" href="http://gbammc.github.io/blog/2014/04/22/django-101/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("gbammc@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">Alvin Zhu</a></h1>
<p class="subtitle">"人类渺小，<br>但不代表我要永世困于壁内。"</p>
<nav id="main-nav"><ul class="main">
	<li><a href="/">首页</a></li>
	<li><a href="/blog/archives">全部文章</a></li>
	<li><a href="/blog/categories">分类列表</a></li>
	<li><a href="/about">关于我</a></li>
	<li><a href="/friends">友情链接</a></li>
	<li><a href="https://itunes.apple.com/cn/app/id574437211">ifanr - 爱范儿客户端</a></li>
	<li><a href="https://itunes.apple.com/cn/app/id611036705">数读 - 用数字读懂世界</a></li>
  <li><a href="https://itunes.apple.com/us/app/id890729702">Q.fm - 最好的《一些事一些情》第三方应用</a></li>
	<li><a href="http://www.scau123.com/hnb/">iSCAU - 华农学子必备</a></li>
</ul></nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/blackteafeng" title="Weibo">Weibo</a>
		
		
		
		<a class="google" href="https://plus.google.com/101572322776670119375" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/alvin_zhu" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/gbammc" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Django + Pip + Virtualenv ＋ Postgres</h1>
	<div class="entry-content" itemprop="articleBody"><h1>前言</h1>

<p>最近兴趣所致，想学习利用 Django 编写一个项目，无奈之前不太懂 python，在机子乱搞一通后发现系统的环境都被玩坏了，GoAgentX 都跑不了..不过经过一番折腾后总算是走上正轨，所以顺便总结一下吧。</p>

<!-- more -->


<h1>安装 python，pip 和 easy_install</h1>

<p>虽然 OS X 已经自带有多个版本的 python，不过还是推荐使用 homebrew 安装一个，因为 homebrew 还会自动帮我们安装 pip 和 easy_install 这两个包管理工具，更详细的关于 python 包管理工具资料请戳<a href="http://jiayanjujyj.iteye.com/blog/1409819">这里</a>：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install python --universal --framework</span></code></pre></td></tr></table></div></figure>


<p>然后我们需要检查是否有 <code>/usr/local/share/python</code> 这个文件夹，如果不存在的话需要建立一个软链接，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ln -s /usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7/bin/ /usr/local/share/python</span></code></pre></td></tr></table></div></figure>


<p>上面的<code>2.7</code>是当前 python 的版本号，按需替换即可。</p>

<hr />

<h1>安装 virtualenv 和 virtualenvwrapper</h1>

<p>virtualenv <a href="http://virtualenv.org/">官网</a> 是这样描述自己的：</p>

<blockquote><p>virtualenv要解决的根本问题是库的版本和依赖，以及权限问题。假设你有一个程序，需要LibFoo的版本1，而另一个程序需要版本2，如何同时使用两个应用程序呢？如果将所有的库都安装在 /usr/lib/python2.7/site-packages（或者你的系统的标准包安装路径），非常容易出现将不该升级的库升级的问题。</p>

<p>另外，在一台共享的机器上，如果没有全局的 site-packages 目录的权限（例如一个共享的主机），如何安装Python库呢？</p>

<p>在这些情况下，就是该用到virtualenv的地方。它能够创建一个自己的安装目录，形成一个独立的环境，不会影响其他的virtualenv环境，甚至可以不受全局的site-packages当中安装的包的影响。</p></blockquote>

<p>通过为每个项目创建虚拟环境，在每个虚拟环境中安装需要的第三方包版本，那么不同的项目就可以独立的使用一个  django 环境。virtualenvwrapper 则为 virtualenv 提供了一些便利的命令行上的封装。</p>

<p>首先在我们的 .bashrc 或( .zshrc )加上:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Before other PATHs...
</span><span class='line'>PATH=${PATH}:/usr/local/share/python
</span><span class='line'>
</span><span class='line'># Python
</span><span class='line'>export WORKON_HOME=$HOME/.virtualenvs
</span><span class='line'>export VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python2.7
</span><span class='line'>export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'
</span><span class='line'>export PIP_VIRTUALENV_BASE=$WORKON_HOME
</span><span class='line'>export PIP_RESPECT_VIRTUALENV=true
</span><span class='line'>if [[ -r /usr/local/share/python/virtualenvwrapper.sh ]]; then
</span><span class='line'>    source /usr/local/share/python/virtualenvwrapper.sh
</span><span class='line'>else
</span><span class='line'>    echo "WARNING: Can't find virtualenvwrapper.sh"
</span><span class='line'>fi
</span><span class='line'>
</span><span class='line'># 
</span></code></pre></td></tr></table></div></figure>


<p>然后安装：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install virtualenv 
</span><span class='line'>$ pip install virtualenvwrapper</span></code></pre></td></tr></table></div></figure>


<p>virtualenvwrapper 的用法当然还是看<a href="http://virtualenvwrapper.readthedocs.org/en/latest/">文档</a>最靠谱啦。</p>

<hr />

<h1>安装 django</h1>

<p>主角来了，首先<code>cd</code>到项目创建目录下，然后用 virtualenv 为我们的项目创建一个虚拟环境：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkvirtualenv env1</span></code></pre></td></tr></table></div></figure>


<p>接着就是安装 django：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pip install django</span></code></pre></td></tr></table></div></figure>


<p>Finished，这就完成啦，实在是太简单了 :]</p>

<hr />

<h1>带上 postgres</h1>

<p>最后，因为公司维护的要求，顺便就上 postgres了 (<a href="http://www.zhihu.com/question/20010554">PostgreSQL 与 MySQL 相比，优势何在？</a>) ，为了 django 能和 postgres 连接，先装<code>psycopg2</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pip install psycopg2</span></code></pre></td></tr></table></div></figure>


<p>然后就修改应用中的<code>settings.py</code>配置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DATABASES = {
</span><span class='line'>    'default': {
</span><span class='line'>        'ENGINE': 'django.db.backends.postgresql_psycopg2', 
</span><span class='line'>        'NAME': 'test',    
</span><span class='line'>        'USER': 'user',                  # Not used with sqlite3.
</span><span class='line'>        'PASSWORD': 'pwd',               # Not used with sqlite3.
</span><span class='line'>        'HOST': '',                      # Set to empty string for localhost. Not used with sqlite3.
</span><span class='line'>        'PORT': '5432',                  # Set to empty string for default. Not used with sqlite3.
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>最后同步一下项目的数据库：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python manage.py syncdb</span></code></pre></td></tr></table></div></figure>

</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style addthis_16x16_style">
	
	<a class="addthis_button_sinaweibo"></a>
	
	
	<a class="addthis_button_facebook"></a>
	
	
	
	
	<a class="addthis_button_compact"></a>
	<a class="addthis_counter addthis_bubble_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
	Copyright &copy; 2014 - 
	
    	Alvin Zhu
	 - 
	Powered by <a href="http://octopress.org">Octopress</a>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'alvinzhusblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gbammc.github.io/blog/2014/04/22/django-101/';
        var disqus_url = 'http://gbammc.github.io/blog/2014/04/22/django-101/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-44493661-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



		</div>
	</div>
</body>
</html>
